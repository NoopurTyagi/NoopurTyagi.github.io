<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>machine learning waypoints (Three.js)</title>
  <script src="https://cdn.jsdelivr.net/npm/three@0.145.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.145.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.145.0/examples/js/loaders/GLTFLoader.js"></script>
  <style>
    .visited {
      font-weight: bold;
      color: green;
    }
  </style>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    h1 {
      margin: 20px 0;
      text-align: center;
      font-size: 2.5em;
      color: #333;
    }
    .panel {
      background: linear-gradient(135deg, #ffffff 0%, #e6e9f0 100%);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      margin: 10px;
      flex: 1;
      max-width: 350px;
      min-width: 280px;
    }
    .waypoints-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      width: 100%;
      max-width: 1200px;
    }
    .panel h2 {
      margin-top: 0;
      font-size: 1.5em;
      color: #444;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    li {
      margin-bottom: 10px;
      padding: 8px 10px;
      background: #f9f9f9;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: background 0.3s;
    }
    li:hover {
      background: #e6e6e6;
    }
    button {
      background: #007bff;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    button:hover {
      background: #0056b3;
      transform: translateY(-2px);
    }
    #navigate-btn {
      background: #28a745;
      border-radius: 50%;
      padding: 20px 25px;
      font-size: 1.5em;
      margin: 20px;
      transition: background 0.3s, transform 0.3s;
    }
    #navigate-btn:hover {
      background: #218838;
      transform: translateY(-2px);
    }
    .central-panel {
      max-width: 100%;
      width: 100%;
      text-align: center;
      padding: 0 10px;
    }
    .central-panel ul {
      max-width: 500px;
      margin: 0 auto;
      text-align: left;
    }
    .central-panel button {
      margin-top: 15px;
    }
    #path-waypoints{
    position: relative !important;
    bottom: 24px !important;
    right: 377px !important;

    }
    #waypoints{
    overflow: scroll !important;
    height: 500px !important;

    }
    @media (max-width: 768px) {
      .panel {
        width: 90%;
        margin: 10px auto;
      }
      #navigate-btn {
        width: 80%;
        text-align: center;
        padding: 15px;
        font-size: 1.25em;
      }
      .central-panel {
        padding: 0 5%;
      }
    }
  </style>
</head>
<body>
  <h1>3D Demogorgon Model</h1>
  <div id="waypoints" style="position: fixed; top: 0; right: 0; background: rgba(255, 255, 255, 0.8); padding: 10px;">
    <h2>Waypoints</h2>
    <ul id="waypoint-list"></ul>
  </div>
  <div id="selected-waypoints" style="position: fixed; bottom: 0; left: 0; background: rgba(255, 255, 255, 0.8); padding: 10px;">
    <h2>Selected Waypoints</h2>
    <p>Start Waypoint: <span id="start-waypoint">None</span></p>
    <p>End Waypoint: <span id="end-waypoint">None</span></p>
  </div>
  <div id="path-waypoints" style="position: fixed; bottom: 0; right: 0; background: rgba(255, 255, 255, 0.8); padding: 10px;">
    <h2>Waypoints Along the Path</h2>
    <ul id="path-waypoint-list"></ul>
    <button id="next-waypoint-btn" onclick="showNextWaypoint()">Go to Next Waypoint</button>
  </div>
  <button id="navigate-btn" onclick="navigate()">Navigate</button>
  <div id="three-container" style="width: 100vw; height: 100vh;"></div>

  <script>
    let scene, camera, renderer, controls, demogorgon;
    let waypoints = [];
    const waypointMap = {};
    const adjacencyList = new Map();

    let startWaypoint = null;
    let endWaypoint = null;
    let animationPath = [];
    let currentWaypointIndex = 0;

    function logInteraction(waypoint) {
      const interaction = {
        waypointId: waypoint.id,
        timestamp: new Date(),
      };
      userInteractions.push(interaction);
      console.log('Logged interaction:', interaction);
    }

    function selectWaypoint(waypointId) {
      const waypoint = waypointMap[waypointId];
      logInteraction(waypoint);  // Log the interaction here
      
      if (!startWaypoint) {
        startWaypoint = waypoint;
        document.getElementById('start-waypoint').textContent = waypoint.name;
      } else if (!endWaypoint) {
        endWaypoint = waypoint;
        document.getElementById('end-waypoint').textContent = waypoint.name;
        findPathAndDraw(startWaypoint, endWaypoint);
      }
    }

    function extractFeatures(interactions) {
      let totalTime = 0;
      for (let i = 1; i < interactions.length; i++) {
        totalTime += interactions[i].timestamp - interactions[i - 1].timestamp;
      }
      const avgTimePerWaypoint = totalTime / (interactions.length - 1);

      return {
        avgTimePerWaypoint: avgTimePerWaypoint || 0,
        totalWaypointsVisited: interactions.length
      };
    }

    const model = {
      predict: function(features) {
        if (features.avgTimePerWaypoint > 5000 || features.totalWaypointsVisited < 3) {
          return 'anomalous';
        }
        return 'normal';
      }
    };

    function classifyUserBehavior(interactions) {
      const features = extractFeatures(interactions);
      const prediction = model.predict(features);
      return prediction; // 'normal' or 'anomalous'
    }

    function navigate() {
      if (!startWaypoint || !endWaypoint) {
        alert("Please select both start and end waypoints");
        return;
      }
      findPathAndDraw(startWaypoint, endWaypoint);
      startAnimation(animationPath);
      
      const prediction = classifyUserBehavior(userInteractions);
      if (prediction === 'anomalous') {
        alert("Unusual navigation behavior detected. Need help?");
      }
    }

    function init() {
      const container = document.getElementById('three-container');

      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xf0f0f0);

      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 2, 5);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      container.appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.25;
      controls.screenSpacePanning = false;
      controls.maxPolarAngle = Math.PI / 2;

      const light = new THREE.HemisphereLight(0xffffff, 0x444444);
      light.position.set(0, 200, 0);
      scene.add(light);

      const loader = new THREE.GLTFLoader();
      loader.load('https://NoopurTyagi.github.io/mymodel4.gltf', function (gltf) {
        demogorgon = gltf.scene;
        demogorgon.scale.set(0.5, 0.5, 0.5);
        scene.add(demogorgon);

        demogorgon.traverse(function (object) {
          if (object.isMesh) object.castShadow = true;
        });

        // Set up waypoints
        setupWaypoints();
        animate();
      });

      window.addEventListener('resize', onWindowResize, false);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function setupWaypoints() {
      // Define waypoints and connections here
    const waypoints = [
      { id: 1, name: "Entrance", x: -8, y: 0, z: -3, connected: [2] },
      { id: 2, name: "Corridor Intersection", x: -6, y: 0, z: -3, connected: [1, 3, 4, 5, 6, 7, 8] },
      { id: 3, name: "Faculty Room 03", x: -6, y: 0, z: -10, connected: [2] },
      { id: 4, name: "Faculty Room 004", x: -2, y: 0, z: 2, connected: [2] },
      { id: 5, name: "Faculty Room 005", x: -6, y: 0, z: 2, connected: [2] },
      { id: 6, name: "Restroom 1", x: -4, y: 0, z: -10, connected: [2] },
      { id: 7, name: "Restroom 2", x: -2, y: 0, z: -10, connected: [2] },
      { id: 8, name: "Pantry", x: -1, y: 0, z: -7, connected: [2] },
      { id: 9, name: "Ground Floor Stairs", x: -1, y: 2, z: -5, connected: [2, 10] },
      { id: 10, name: "Ground Floor Stairs End", x: 0, y: 4, z: -6, connected: [9, 11] },
      { id: 11, name: "First Floor Stairs", x: 0, y: 4, z: -4, connected: [10, 12] },
      { id: 12, name: "Corridor", x: -5, y: 3.5, z: -4, connected: [11, 13] },
      { id: 13, name: "First Floor Corridor Intersection", x: -6, y: 3.5, z: 3, connected: [12, 14] },
      { id: 14, name: "First Floor Room 1", x: -1, y: 3.5, z: -1, connected: [13] }
    ];

      renderWaypoints();
    }

    function addEdge(startId, endId) {
      adjacencyList.get(startId).push(endId);
      adjacencyList.get(endId).push(startId);
    }

    function renderWaypoints() {
      const waypointList = document.getElementById('waypoint-list');
      waypointList.innerHTML = '';
      waypoints.forEach(waypoint => {
        const li = document.createElement('li');
        li.textContent = waypoint.name;
        li.id = `waypoint-${waypoint.id}`;
        li.onclick = () => selectWaypoint(waypoint.id);
        waypointList.appendChild(li);
      });
    }

    function findPathAndDraw(start, end) {
      const path = bfs(start.id, end.id);
      drawPath(path);
    }

    function bfs(startId, endId) {
      const queue = [[startId]];
      const visited = new Set();

      while (queue.length > 0) {
        const path = queue.shift();
        const node = path[path.length - 1];

        if (node === endId) {
          return path;
        }

        if (!visited.has(node)) {
          visited.add(node);
          const neighbors = adjacencyList.get(node);
          neighbors.forEach(neighbor => {
            const newPath = [...path, neighbor];
            queue.push(newPath);
          });
        }
      }

      return null;
    }

    function drawPath(path) {
      if (!path) {
        alert("No path found!");
        return;
      }

      animationPath = path.map(id => waypointMap[id].position);
      currentWaypointIndex = 0;
      document.getElementById('path-waypoint-list').innerHTML = path.map(id => `<li>${waypointMap[id].name}</li>`).join('');
    }

    function startAnimation(path) {
      if (!path || path.length === 0) {
        return;
      }

      const target = path[currentWaypointIndex];
      if (!target) {
        return;
      }

      const duration = 1000;
      const initialPosition = camera.position.clone();
      const targetPosition = new THREE.Vector3(target.x, camera.position.y, target.z);

      const tween = new TWEEN.Tween(initialPosition)
        .to(targetPosition, duration)
        .easing(TWEEN.Easing.Quadratic.Out)
        .onUpdate(() => {
          camera.position.copy(initialPosition);
          controls.update();
        })
        .onComplete(() => {
          currentWaypointIndex++;
          if (currentWaypointIndex < path.length) {
            startAnimation(path);
          }
        })
        .start();
    }

    function showNextWaypoint() {
      if (currentWaypointIndex < animationPath.length) {
        startAnimation(animationPath.slice(currentWaypointIndex));
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      TWEEN.update();
      renderer.render(scene, camera);
    }

    init();
  </script>
</body>
</html>



