<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GLTF Viewer with Navigation (Three.js)</title>
  <script src="https://cdn.jsdelivr.net/npm/three@0.145.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.145.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.145.0/examples/js/loaders/GLTFLoader.js"></script>
  <style>
    .visited {
      font-weight: bold;
      color: green;
    }
  </style>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    h1 {
      margin: 20px 0;
      text-align: center;
      font-size: 2.5em;
      color: #333;
    }
    .panel {
      background: linear-gradient(135deg, #ffffff 0%, #e6e9f0 100%);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      margin: 10px;
      flex: 1;
      max-width: 350px;
      min-width: 280px;
    }
    .waypoints-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      width: 100%;
      max-width: 1200px;
    }
    .panel h2 {
      margin-top: 0;
      font-size: 1.5em;
      color: #444;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    li {
      margin-bottom: 10px;
      padding: 8px 10px;
      background: #f9f9f9;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: background 0.3s;
    }
    li:hover {
      background: #e6e6e6;
    }
    button {
      background: #007bff;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    button:hover {
      background: #0056b3;
      transform: translateY(-2px);
    }
    #navigate-btn {
      background: #28a745;
      border-radius: 50%;
      padding: 20px 25px;
      font-size: 1.5em;
      margin: 20px;
      transition: background 0.3s, transform 0.3s;
    }
    #navigate-btn:hover {
      background: #218838;
      transform: translateY(-2px);
    }
    .central-panel {
      max-width: 100%;
      width: 100%;
      text-align: center;
      padding: 0 10px;
    }
    .central-panel ul {
      max-width: 500px;
      margin: 0 auto;
      text-align: left;
    }
    .central-panel button {
      margin-top: 15px;
    }
    #path-waypoints{
      position: relative !important;
      bottom: 24px !important;
      right: 377px !important;
    }
    #waypoints{
      overflow: scroll !important;
      height: 500px !important;
    }
    @media (max-width: 768px) {
      .panel {
        width: 90%;
        margin: 10px auto;
      }
      #navigate-btn {
        width: 80%;
        text-align: center;
        padding: 15px;
        font-size: 1.25em;
      }
      .central-panel {
        padding: 0 5%;
      }
    }
  </style>
</head>
<body>
  <h1>3D Demorgon Model</h1>
  <div id="waypoints" style="position: fixed; top: 0; right: 0; background: rgba(255, 255, 255, 0.8); padding: 10px;">
    <h2>Waypoints</h2>
    <ul id="waypoint-list"></ul>
  </div>
  <div class="waypoints-container">
    <div class="panel central-panel">
      <h2>Navigate</h2>
      <ul id="path-waypoint-list"></ul>
      <button id="navigate-btn">Start Navigation</button>
    </div>
  </div>
  <div id="rendererContainer" style="width: 100%; height: 100vh;"></div>
  <script>
    // Initial Setup
    let scene, camera, renderer, controls, gltfLoader;
    let waypoints = [];
    let waypointMap = {};
    let line = null;
    let animationPath = [];
    let animationIndex = 0;

    init();

    function init() {
      // Scene setup
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xa0a0a0);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 5, 10);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('rendererContainer').appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.update();

      // Light setup
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(5, 10, 7.5);
      scene.add(light);

      // GLTF Loader setup
      gltfLoader = new THREE.GLTFLoader();
      gltfLoader.load('https://NoopurTyagi.github.io/mymodel4.gltf', gltf => {
        scene.add(gltf.scene);
      });

      // Waypoints data with weights (distances)
      waypoints = [
        { id: 1, name: 'Entrance', x: 0, y: 0, z: 0, connected: [{id: 2, weight: 5}, {id: 3, weight: 5}] },
      { id: 1, name: "Entrance", x: -8, y: 0, z: -3, connected: [{id:2,weight:1}] },
      { id: 2, name: "Corridor Intersection", x: -6, y: 0, z: -3, connected: [{id:1,weight:1},{id:3,weight:2},{id:4,weight:2},{id:5,weight:2},{id:6,weight:2},{id:7,weight:2},{id:8,weight:2}] },
      { id: 3, name: "Faculty Room 03", x: -6, y: 0, z: -10, connected: [2] },
      { id: 4, name: "Faculty Room 004", x: -2, y: 0, z: 2, connected: [2] },
      { id: 5, name: "Faculty Room 005", x: -6, y: 0, z: 2, connected: [2] },
      { id: 6, name: "Restroom 1", x: -4, y: 0, z: -10, connected: [2] },
      { id: 7, name: "Restroom 2", x: -2, y: 0, z: -10, connected: [2] },
      { id: 8, name: "Pantry", x: -1, y: 0, z: -7, connected: [2] },
      { id: 9, name: "Ground Floor Stairs", x: -1, y: 2, z: -5, connected: [2, 10] },
      { id: 10, name: "Ground Floor Stairs End", x: 0, y: 4, z: -6, connected: [9, 11] },
      { id: 11, name: "First Floor Stairs", x: 0, y: 4, z: -4, connected: [10, 12] },
      { id: 12, name: "Corridor", x: -5, y: 3.5, z: -4, connected: [11, 13] },
      { id: 13, name: "First Floor Corridor Intersection", x: -6, y: 3.5, z: 3, connected: [12, 14] },
      { id: 14, name: "LH1", x: -6, y: 3.5, z: 5, connected: [13,15] },
      { id: 15, name: "LH2", x: -6, y: 3.5, z: 8, connected: [13] },
      { id: 16, name: "LH3", x: -6, y: 3.5, z: -10, connected: [12] },
      { id: 17, name: "LH4", x: -6, y: 3.5, z: -12, connected: [12,16] },
      { id: 18, name: "second Floor Stairs", x: 0, y: 5, z: -4, connected: [11,19] },
      { id: 19, name: "second Floor Stairs End", x: 0, y: 7, z: -4, connected: [18,20] },
      { id: 20, name: "third Floor corridor", x: -5, y: 7, z: -3, connected: [19,21] },
      { id: 21, name: "third Floor corridor intersection ", x: -5, y: 7, z: -2, connected: [20,21] },
      { id: 22, name: "LH5", x: -5, y: 7, z: 5, connected: [21,23] },
      { id: 23, name: "LH6", x: -5, y: 7, z: 8, connected: [22] },
      { id: 24, name: "Restroom3", x: -5, y: 7, z: -5, connected: [20] },
      
    ];

      waypoints.forEach(waypoint => {
        waypointMap[waypoint.id] = waypoint;
      });

      populateWaypointList();

      animate();
    }

    function populateWaypointList() {
      const waypointList = document.getElementById('waypoint-list');
      waypoints.forEach(waypoint => {
        const listItem = document.createElement('li');
        listItem.textContent = waypoint.name;
        listItem.dataset.id = waypoint.id;
        listItem.addEventListener('click', () => onWaypointClick(waypoint));
        waypointList.appendChild(listItem);
      });
    }

    function onWaypointClick(waypoint) {
      if (!waypoint.visited) {
        waypoint.visited = true;
        const listItem = document.querySelector(`[data-id='${waypoint.id}']`);
        listItem.classList.add('visited');
      }
      camera.position.set(waypoint.x, waypoint.y + 2, waypoint.z + 2);
      controls.update();
    }

    document.getElementById('navigate-btn').addEventListener('click', () => {
      const start = waypoints.find(wp => wp.name === 'Entrance');
      const end = waypoints.find(wp => wp.name === 'Conference Room');
      findPathAndDraw(start, end);
    });

    // Priority Queue implementation
    class PriorityQueue {
      constructor() {
        this.collection = [];
      }
      enqueue(element, priority) {
        const node = { element, priority };
        if (this.isEmpty()) {
          this.collection.push(node);
        } else {
          let added = false;
          for (let i = 0; i < this.collection.length; i++) {
            if (node.priority < this.collection[i].priority) {
              this.collection.splice(i, 0, node);
              added = true;
              break;
            }
          }
          if (!added) {
            this.collection.push(node);
          }
        }
      }
      dequeue() {
        return this.collection.shift();
      }
      isEmpty() {
        return this.collection.length === 0;
      }
    }

    // Heuristic function using Euclidean distance
    function heuristic(a, b) {
      return Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2 + (a.z - b.z) ** 2);
    }

    function aStar(startId, endId) {
      const openSet = new PriorityQueue();
      const cameFrom = {};
      const gScore = {};
      const fScore = {};

      waypoints.forEach(waypoint => {
        gScore[waypoint.id] = Infinity;
        fScore[waypoint.id] = Infinity;
      });

      gScore[startId] = 0;
      fScore[startId] = heuristic(waypointMap[startId], waypointMap[endId]);
      openSet.enqueue(startId, fScore[startId]);

      while (!openSet.isEmpty()) {
        const current = openSet.dequeue().element;

        if (current === endId) {
          const path = [];
          let temp = current;
          while (temp !== null) {
            path.push(waypointMap[temp]);
            temp = cameFrom[temp];
          }
          return path.reverse();
        }

        waypointMap[current].connected.forEach(neighbor => {
          const tentativeGScore = gScore[current] + neighbor.weight; // Use weight from the connection
          if (tentativeGScore < gScore[neighbor.id]) {
            cameFrom[neighbor.id] = current;
            gScore[neighbor.id] = tentativeGScore;
            fScore[neighbor.id] = gScore[neighbor.id] + heuristic(waypointMap[neighbor.id], waypointMap[endId]);
            openSet.enqueue(neighbor.id, fScore[neighbor.id]);
          }
        });
      }

      return [];
    }

    // Function to find and draw path using A* algorithm
    function findPathAndDraw(start, end) {
      if (line) {
        scene.remove(line);
      }

      const path = aStar(start.id, end.id);
      if (path.length === 0) {
        alert("No path found!");
        return;
      }

      const points = path.map(waypoint => new THREE.Vector3(waypoint.x, waypoint.y, waypoint.z));
      const geometry = new THREE.BufferGeometry().setFromPoints(points);
      const material = new THREE.LineBasicMaterial({ color: 0xff0000 });
      line = new THREE.Line(geometry, material);
      scene.add(line);

      const pathWaypointList = document.getElementById('path-waypoint-list');
      pathWaypointList.innerHTML = '';
      path.forEach((waypoint, index) => {
        const listItem = document.createElement('li');
        listItem.textContent = `${index + 1}. ${waypoint.name}`;
        pathWaypointList.appendChild(listItem);
      });

      animationPath = path;
      animationIndex = 0;

      console.log('Path found and drawn');
    }

    // Animation loop
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
  </script>
</body>
</html>
